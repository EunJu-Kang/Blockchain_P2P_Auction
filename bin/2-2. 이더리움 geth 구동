#폴더 생성
mkdir ./dev/eth_prac001

#가상머신에 geth 설치
sudo apt-get update
sudo apt-get install software-properties-common
sudo add-apt-repository -y ppa:ethereum/ethereum
sudo apt-get install ethereum

#잘 설치되었나 확인
geth version

#디렉토리 구조 만들기
mkdir -p dev/eth_localdata
cd dev/eth_localdata/

#Geth를 이용해 Ethereum Private Network를 구성하기 위해서는 처음 제네시스 블록을 생성해 주어야 한다.
#CustomGenesis.json에 제네시스 블록에 대한 설정을 해주게 된댜.
vi CustomGenesis.json

#위 json파일에 넣기
{
"config": {
"chainId": 15150,
"homesteadBlock": 0,
"eip155Block": 0,
"eip158Block": 0
},
"difficulty": "0x10",
"coinbase": "0x0000000000000000000000000000000000000000",
"gasLimit": "9999999",
"alloc": {},
"extraData": "",
"nonce": "0xdeadbeefdeadbeef",
"mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
"parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
"timestamp": "0x00"
}

#geth 구동
geth --datadir ~/Ethereum1/dev/eth_localdata/ init ~/Ethereum1/dev/eth_localdata/CustomGenesis.json
geth --datadir ~/Ethereum2/dev/eth_localdata/ init ~/Ethereum2/dev/eth_localdata/CustomGenesis.json
geth --datadir ~/Ethereum3/dev/eth_localdata/ init ~/Ethereum3/dev/eth_localdata/CustomGenesis.json


sudo apt install tree
tree 쳐서 확인해보기

#static-nodes.json 만들기 -> 1번 노드를 메인드로 사용할것이므로 1번에만 쓰면 됨 나머지만 연결
{
   "geth --networkid 15150 --maxpeers 5 --datadir ~/Ethereum2/dev/eth_localdata/ --port 3334 console 2>> ~/Ethereum2/dev/eth_localdata/geth.log",
 "geth --networkid 15150 --maxpeers 5 --datadir ~/Ethereum3/dev/eth_localdata/ --port 3335 console 2>> ~/Ethereum3/dev/eth_localdata/geth.log"
}


#구동시키기
#1번 노드
geth --networkid 15150 --datadir ~/Ethereum1/dev/eth_localdata --port 3333 --rpc --rpcport 8545 --rpcaddr 0.0.0.0 --rpccorsdomain "*" --rpcapi "admin,net,miner,eth,rpc,web3,txpool,debug,db,personal" --allow-insecure-unlock console 2>> ~/Ethereum1/dev/eth_localdata/geth.log
=> unlock 명령어 먹히려면 --allow~~해야함

-nohup이랑 console 앞에 &을 붙여서 계속 돌아가고 있게 할수 있다.
nohup geth --networkid 15150 --datadir ~/Ethereum1/dev/eth_localdata --port 3333 --rpc --rpcport 8545 --rpcaddr 0.0.0.0 --rpccorsdomain "*" --rpcapi "admin,net,miner,eth,rpc,web3,txpool,debug,db,personal" & console 2>> ~/Ethereum1/dev/eth_localdata/geth.log
=> 빨간색 부분 넣으면 rpc 포트 열어서 접속: 해킹당할 수 있음.

nohup geth --networkid 15150 --datadir ~/Ethereum1/dev/eth_localdata --port 3333 --mine -minerthreads 1 --etherbase "0x34731f88a25c5f21922233d86372f91ae3539ca2" & console 2>> ~/Ethereum1/dev/eth_localdata/geth.log
=> rpc 포트 열지 않아서 해킹안당하지만 우리도 못들어감 ㅋㅋ geth 작동시킬때 --mine~~을  넣으면 백그라운드로 돌면서 채굴도 동시에 함

※ nohup 으로 키고 geth를 끄지 않았는데  ps로 안뜨면 (ps -ef | grep geth)로 확인 => 끄는방법 : kill [PID]

#2번 노드
geth --networkid 15150 --maxpeers 5 --datadir ~/Ethereum2/dev/eth_localdata/ --port 3334 console 2>> ~/Ethereum2/dev/eth_localdata/geth.log
#3번 노드
geth --networkid 15150 --maxpeers 5 --datadir ~/Ethereum3/dev/eth_localdata/ --port 3335 console 2>> ~/Ethereum3/dev/eth_localdata/geth.log


#1번노드: 2, 2번노드: 1, 3번노드: 1이 잘 나오나 확인
net.peerCount

#주소가 나옴 복사
admin.nodeInfo.enode

personal.newAccount()
:비밀번호 입력
